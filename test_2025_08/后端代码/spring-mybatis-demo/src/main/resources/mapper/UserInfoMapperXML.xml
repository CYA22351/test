<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cya.springmybatisdemo.mapper.UserInfoMapperXML">

<resultMap id="BaseMap" type="com.cya.springmybatisdemo.model.UserInfo">
     <id property="id" column="id"></id>
    <result property="deleteFlag" column="delete_flag"></result>
    <result property="createTime" column="create_time"></result>
    <result property="updateTime" column="update_time"></result>

</resultMap>
<!--    sql片段-->
    <sql id="sql">
        select * from user_info
    </sql>

    <select id="selectAll" resultType="com.cya.springmybatisdemo.model.UserInfo">
        select id, username, `password`, age, gender, phone, delete_flag as
            deleteFlag,create_time as createTime, update_time as updateTime from user_info

--         select * from user_info

    </select>

    <select id="selectAll2" resultMap="BaseMap">

 <include refid="sql">

 </include>

    </select>

<!--        动态sql查询-->
    <select id="selectByCindition" resultType="com.cya.springmybatisdemo.model.UserInfo"
            parameterType="com.cya.springmybatisdemo.model.UserInfo">
        select * from user_info
        --         where语块没有内容是=时，会去除where关键字，当where语句块有查询条件时会添加where关键字，还会去除最前面的and
        <where>
            <trim prefixOverrides="and">
                <if test="phone!=null">
                    and phone=#{phone}
                </if>
                <if test="deleteFlag!=null">
                    and delete_flag=#{deleteFlag}
                </if>
            </trim></where>





        <!--        select * from user_info where 1=1-->
        <!--        全部为null时，添加1=1                              <trim >-->
        <!--                                          <if test="phone!=null">-->
        <!--                                             and phone=#{phone}-->
        <!--                                          </if>-->
        <!--                                          <if test="deleteFlag!=null">-->
        <!--                                              and delete_flag=#{deleteFlag}-->
        <!--                                          </if>-->
        <!--                                      </trim>-->

        <!--                                    <trim prefixOverrides="and">-->
        <!--                                        <if test="phone!=null">-->
        <!--                                            phone=#{phone}-->
        <!--                                        </if>-->
        <!--                                        <if test="deleteFlag!=null">-->
        <!--                                            and delete_flag=#{deleteFlag}-->
        <!--                                        </if>-->
        <!--                                    </trim>-->


    </select>
    <update id="updateUser">
    update user_info set password=#{password},age=#{age} where id=#{id}
    </update>

    <update id="updateByConfition">
        update user_info
--             set标签去除多余逗号，
        <set>
            <if test="password!=n8ll">
                password=#{password},
            </if>
            <if test="age!=null">
                age=#{age},
            </if>
            <if test="gender!=null">
                gender=#{gender}
            </if>
        </set>


--                            不能全部为空
<!--                             <trim suffixOverrides=",">-->
<!--                             <if test="password!=n8ll">-->
<!--                                 password=#{password},-->
<!--                             </if>-->
<!--                                 <if test="age!=null">-->
<!--                                     age=#{age},-->
<!--                                 </if>-->
<!--                                 <if test="gender!=null">-->
<!--                                     gender=#{gender}-->
<!--                                 </if>-->
<!--                             </trim>-->

                         where id=#{id}
    </update>

    <delete id="deleteUser">
            delete from user_info where id=#{id}
    </delete>
    <delete id="batchDelete">
        delete from user_info where id in
--                                     (23,22,21,20)
                              <foreach collection="ids" open="(" close=")" separator="," item="id">
                                  #{id}
                              </foreach>
--         id=1 or id=2 or id=3
<!--        <foreach collection="ids" separator="or" item="id">-->
<!--           id= #{id}-->
<!--        </foreach>-->
    </delete>




    <insert id="insertUser">
        insert into user_info(username,password,age) values (#{username},#{password},#{age})
    </insert>

    <insert id="insertUser2" useGeneratedKeys="true" keyProperty="id">

        insert into user_info(username,password,age) values (#{userinfo.username},#{userinfo.password},#{userinfo.age})
    </insert>

<!--    if标签-->
    <insert id="insertUser3" >

        insert into user_info
        <trim prefixOverrides="," suffixOverrides="," prefix="(" suffix=")">
            <if test="username!=null">
                username,
            </if>
            <if test="password!=null">
               password,
            </if>
            <if test="age!=null">
                age,
            </if>
            <if test="gender!=null">
            gender,
        </if>
            <if test="phone!=null">
                phone
            </if>
        </trim>

        values
                <trim prefixOverrides="," suffixOverrides="," prefix="(" suffix=")">
                    <if test="username!=null">
                        #{username},
                    </if>
                    <if test="password!=null">
                         #{password},
                    </if>
                    <if test="age!=null">
                         #{age},
                    </if>
                    <if test="gender!=null">
                        #{gender},
                    </if>
                    <if test="phone!=null" >
                        #{phone}
                    </if>
                </trim>

    </insert>
</mapper>