<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图书列表展示</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <link rel="stylesheet" href="css/list.css">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script src="js/jq-paginator.js"></script>

</head>

<body>
    <div class="bookContainer">
        <h2>图书列表展示</h2>
        <div class="navbar-justify-between">
            <div>
                <button class="btn btn-outline-info" type="button" onclick="location.href='book_add.html'">添加图书</button>
                <button class="btn btn-outline-info" type="button" onclick="batchDelete()">批量删除</button>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <td>选择</td>
                    <td class="width100">图书ID</td>
                    <td>书名</td>
                    <td>作者</td>
                    <td>数量</td>
                    <td>定价</td>
                    <td>出版社</td>
                    <td>状态</td>
                    <td class="width200">操作</td>
                </tr>
            </thead>
            <tbody>
<!--                <tr>-->
<!--                    <td><input type="checkbox" name="selectBook" value="1" id="selectBook" class="book-select"></td>-->
<!--                    <td>1</td>-->
<!--                    <td>大秦帝国第一册</td>-->
<!--                    <td>我是作者</td>-->
<!--                    <td>23</td>-->
<!--                    <td>33.00</td>-->
<!--                    <td>北京出版社</td>-->
<!--                    <td>可借阅</td>-->
<!--                    <td>-->
<!--                        <div class="op">-->
<!--                            <a href="book_update.html?bookId=1">修改</a>-->
<!--                            <a href="javascript:void(0)" onclick="deleteBook(1)">删除</a>-->
<!--                        </div>-->
<!--                    </td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td><input type="checkbox" name="selectBook" value="1" id="selectBook" class="book-select"></td>-->
<!--                    <td>2</td>-->
<!--                    <td>大秦帝国第二册</td>-->
<!--                    <td>我是作者</td>-->
<!--                    <td>23</td>-->
<!--                    <td>33.00</td>-->
<!--                    <td>北京出版社</td>-->
<!--                    <td>可借阅</td>-->
<!--                    <td>-->
<!--                        <div class="op">-->
<!--                            <a href="book_update.html?bookId=2">修改</a>-->
<!--                            <a href="javascript:void(0)" onclick="deleteBook(2)">删除</a>-->
<!--                        </div>-->
<!--                    </td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td><input type="checkbox" name="selectBook" value="1" id="selectBook" class="book-select"></td>-->
<!--                    <td>3</td>-->
<!--                    <td>大秦帝国第三册</td>-->
<!--                    <td>我是作者</td>-->
<!--                    <td>23</td>-->
<!--                    <td>33.00</td>-->
<!--                    <td>北京出版社</td>-->
<!--                    <td>可借阅</td>-->
<!--                    <td>-->
<!--                        <div class="op">-->
<!--                            <a href="book_update.html?bookId=3">修改</a>-->
<!--                            <a href="javascript:void(0)" onclick="deleteBook(3)">删除</a>-->
<!--                        </div>-->
<!--                    </td>-->
<!--                </tr>-->
<!--                <tr>-->
<!--                    <td><input type="checkbox" name="selectBook" value="1" id="selectBook" class="book-select"></td>-->
<!--                    <td>4</td>-->
<!--                    <td>大秦帝国第四册</td>-->
<!--                    <td>我是作者</td>-->
<!--                    <td>23</td>-->
<!--                    <td>33.00</td>-->
<!--                    <td>北京出版社</td>-->
<!--                    <td>可借阅</td>-->
<!--                    <td><div class="op">-->
<!--                            <a href="book_update.html?bookId=4">修改</a>-->
<!--                            <a href="javascript:void(0)" onclick="deleteBook(4)">删除</a>-->
<!--                        </div>-->
<!--                    </td>-->
<!--                </tr>-->
            </tbody>
        </table>

        <div class="demo">
            <ul id="pageContainer" class="pagination justify-content-center"></ul>
        </div>
        <script>

            getBookList();
            function getBookList() {
                $.ajax({
                    type:"get",
                    url:"/book/getListByPage"+location.search,
                    success:function (result){
                        if(result==null||result.code=="UNLOGIN"){
                            alert("用户未登录，请先登录");
                            location.href="login.html"
                        }
                        if (result==null||result.data==null){
                            return;
                        }
                        var  data=result.data;

                        var books=data.records;
                        var fianalHtml="";
                        for (var book of books){
                            fianalHtml+='<tr>';
                            fianalHtml+='<td><input type="checkbox" name="selectBook" value="'+book.id+'" id="selectBook" class="book-select"></td>';
                            fianalHtml+='<td>'+book.id+'</td>';
                            fianalHtml+='<td>'+book.bookName+'</td>';
                            fianalHtml+='<td>'+book.author+'</td>';
                            fianalHtml+='<td>'+book.count+'</td>';
                            fianalHtml+='<td>'+book.price+'</td>';
                            fianalHtml+='<td>'+book.publish+'</td>';
                            fianalHtml+='<td>'+book.statusCN+'</td>';
                            fianalHtml+='<td><div class="op">';
                            fianalHtml+='<a href="book_update.html?bookId='+book.id+'">修改</a>';
                            fianalHtml+='<a href="javascript:void(0)" onclick="deleteBook('+book.id+')">删除</a>';
                            fianalHtml+='</div>';
                            fianalHtml+='</td>';
                            fianalHtml+='</tr>';
                        }

                        $("tbody").html(fianalHtml);

                        //翻页信息
                        $("#pageContainer").jqPaginator({
                            totalCounts: data.total, //总记录数
                            pageSize: 10,    //每页的个数
                            visiblePages: 5, //可视页数
                            currentPage: data.pageRequest.currentPage,  //当前页码
                            first: '<li class="page-item"><a class="page-link">首页</a></li>',
                            prev: '<li class="page-item"><a class="page-link" href="javascript:void(0);">上一页<\/a><\/li>',
                            next: '<li class="page-item"><a class="page-link" href="javascript:void(0);">下一页<\/a><\/li>',
                            last: '<li class="page-item"><a class="page-link" href="javascript:void(0);">最后一页<\/a><\/li>',
                            page: '<li class="page-item"><a class="page-link" href="javascript:void(0);">{{page}}<\/a><\/li>',
                            //页面初始化和页码点击时都会执行
                            onPageChange: function (page, type) {
                                if (type=="change"){
                                    location.href="book_list.html?currentPage="+page;
                                }

                            }
                        });
                    },
                    error:function (error){
                        if (error.status==401){
                            alert("用户未登录，请先登录")
                            location.href="login.html"
                        }
                        console.log(error)//拦截所有请求
                    }
                })
            }

            //翻页信息

            function deleteBook(id) {
                var isDelete = confirm("确认删除?");
                if (isDelete) {
                    //删除图书
                    $.ajax({
                        type: "post",
                        url:"/book/deleteBook?BookId="+id,//直接在路径上写参数，路径上册参数要跟后端的接口参数一样
                        success:function (result){
                            console.log(result)
                            console.log(result.data)
                            console.log(result.code)
                            if (result.code=="SUCCESS"&&result.data==""){
                                location.href="book_list.html?currentPage=1"
                            }else {
                                alert(result.errMsg)
                            }
                        }
                    })
                    // alert("删除成功");
                }
            }
            //批量删除
            function batchDelete() {
                var isDelete = confirm("确认批量删除?");
                if (isDelete) {
                    //获取复选框的id
                    var ids = [];
                    $("input:checkbox[name='selectBook']:checked").each(function () {
                        ids.push($(this).val());
                    });
                    console.log(ids);
                    $.ajax({
                        type:"post",
                        url:"/book/batchDeleteBook?ids="+ids,
                        success:function (result){
                            if (result.code=="SUCCESS"&&result.data==true){
                                location.href="book_list.html?currentPage=1";
                            }else {
                                alert("批量删除失败")
                            }

                        }

                    })
                }
            }

        </script>
    </div>
</body>

</html>